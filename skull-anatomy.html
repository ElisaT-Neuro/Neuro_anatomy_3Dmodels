<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Skull Anatomy Quiz</title>
    <script type="text/javascript" src="https://static.sketchfab.com/api/sketchfab-viewer-1.12.1.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 0; background-color: #f0f0f0; }
        #header { padding: 20px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        #api-frame { width: 80%; height: 500px; border: none; margin-top: 20px; }
        #quiz-container { margin-top: 20px; background: rgba(255, 255, 255, 0.9); padding: 15px; border-radius: 5px; display: inline-block; }
        #next-button { background-color: #007bff; color: white; padding: 10px; border: none; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        #next-button:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <div id="header">
        <h1>Skull Anatomy Quiz</h1>
        <a href="index.html">Back to Quiz Selection</a>
    </div>

    <!-- Sketchfab Model -->
    <iframe id="api-frame" src="https://sketchfab.com/models/fd3ccceafd5947acaacb468be88d1a9c/embed"
        allow="autoplay; fullscreen; xr-spatial-tracking; gyroscope; accelerometer" allowfullscreen>
    </iframe>

    <!-- Quiz Content -->
    <div id="quiz-container">
        <p id="question">Question 1: Which bone forms the forehead?</p>
        <div id="options"></div>
        <button id="next-button" onclick="nextQuestion()">Next Question</button>
    </div>

    <script>
        let sketchfabAPI;
        let currentQuestionIndex = 0;

        const questions = [
            { type: "multipleChoice", text: "Which bone forms the forehead?", options: [
                { answer: "Frontal Bone", correct: true },
                { answer: "Temporal Bone", correct: false }
            ]},
            { type: "annotation", text: "Click on the annotation corresponding to the Optic Canal.", annotationId: 3 }
        ];

        function nextQuestion() {
            if (currentQuestionIndex < questions.length) {
                const questionData = questions[currentQuestionIndex];
                document.getElementById("question").innerText = questionData.text;
                document.getElementById("options").innerHTML = "";

                if (questionData.type === "multipleChoice") {
                    questionData.options.forEach(option => {
                        let button = document.createElement("button");
                        button.innerText = option.answer;
                        button.onclick = () => alert(option.correct ? "Correct!" : "Try Again!");
                        document.getElementById("options").appendChild(button);
                    });
                } else if (questionData.type === "annotation") {
                    document.getElementById("options").innerHTML = `<p>Click on Annotation #${questionData.annotationId} in the Sketchfab model.</p>`;
                    
                    // Make sure Sketchfab API is loaded before navigating
                    if (sketchfabAPI) {
                        console.log("Navigating to Annotation #" + questionData.annotationId);
                        sketchfabAPI.gotoAnnotation(questionData.annotationId);
                    } else {
                        console.log("Sketchfab API not loaded yet, retrying...");
                        setTimeout(() => {
                            if (sketchfabAPI) {
                                sketchfabAPI.gotoAnnotation(questionData.annotationId);
                            } else {
                                alert("Error: Sketchfab API failed to load.");
                            }
                        }, 2000);
                    }
                }

                currentQuestionIndex++;
            } else {
                alert("Quiz Complete! Thanks for participating.");
            }
        }

        function initSketchfabAPI() {
            var iframe = document.getElementById('api-frame');
            var client = new Sketchfab(iframe);

            client.init({
                success: function(api) {
                    sketchfabAPI = api;
                    console.log("Sketchfab API Loaded Successfully!");

                    sketchfabAPI.addEventListener('annotationFocus', function(index) {
                        const currentQuestion = questions[currentQuestionIndex - 1];
                        if (currentQuestion.type === "annotation" && index === currentQuestion.annotationId) {
                            alert("Correct! You found the right annotation.");
                        } else if (currentQuestion.type === "annotation") {
                            alert("Try Again! That is not the correct annotation.");
                        }
                    });
                },
                error: function() {
                    console.log("Sketchfab API failed to load.");
                    alert("Error loading Sketchfab model.");
                }
            });
        }

        window.onload = () => {
            initSketchfabAPI();
            nextQuestion();
        };
    </script>

</body>
</html>
